version: "2.1"

networks:
  net:
    driver: "bridge"

volumes:
  mysql_data:
    driver: "local"

services:
  # -*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
  # -* GITEA
  # -*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
  localbuild_gitea:
    image: gitea/gitea:1.10.0
    container_name: localbuild_gitea
    hostname: localbuild_gitea
    networks:
      - net
    ports:
      - 13000:13000
      - 122:122
    logging:
      driver: json-file
      options:
        max-size: 512m
    restart: always
    healthcheck:
      test: wget http://127.0.0.1:13000 -q -O - > /dev/null 2>&1
      interval: 10s
      timeout: 20s
      retries: 10
    volumes:
      - ${BASEPATH}/vendor/gitea:/data
  # -*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
  # -* JENKINS
  # -*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
#  localbuild_jenkins:
#    image: jenkins/jenkins:2.190.3-alpine
#    container_name: localbuild_jenkins
#    hostname: localbuild_jenkins
#    networks:
#      - net
#    ports:
#      - 18080:8080
#      - 50000:50000
#    logging:
#      driver: json-file
#      options:
#        max-size: 512m
#    restart: always
#    healthcheck:
#      test: wget http://127.0.0.1:8080/login -q -O - > /dev/null 2>&1
#      interval: 10s
#      timeout: 20s
#      retries: 10
#    volumes:
#      - ${BASEPATH}/vendor/jenkins:/var/jenkins_home
  # -*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
  # -* DOCKER REGISTRY
  # -*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
  localbuild_registry:
    image: registry:2.7.1
    container_name: localbuild_registry
    hostname: localbuild_registry
    networks:
      - net
    ports:
      - 15000:5000
    logging:
      driver: json-file
      options:
        max-size: 512m
    restart: always
    healthcheck:
      test: wget http://127.0.0.1:5000 -q -O - > /dev/null 2>&1
      interval: 10s
      timeout: 20s
      retries: 10
    volumes:
      - ${BASEPATH}/vendor/registry/auth:/data/registry/auth
      - ${BASEPATH}/vendor/registry/data:/var/lib/registry
      - ${BASEPATH}/vendor/registry/config/config.yml:/etc/docker/registry/config.yml
    environment:
      - REGISTRY_AUTH=htpasswd
      - REGISTRY_AUTH_HTPASSWD_REALM="Registry Realm"
      - REGISTRY_AUTH_HTPASSWD_PATH=/data/registry/auth/htpasswd
  # -*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
  # -* DRONE
  # -*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
  localbuild_drone:
    image: drone/drone:1.6.3
    container_name: localbuild_drone
    hostname: localbuild_drone
    networks:
      - net
    ports:
      - 18980:80
    logging:
      driver: json-file
      options:
        max-size: 512m
    restart: always
    healthcheck:
      test: wget http://127.0.0.1 -q -O - > /dev/null 2>&1
      interval: 10s
      timeout: 20s
      retries: 10
    volumes:
      - ${BASEPATH}/vendor/drone:/data
    environment:
      - DRONE_AGENTS_ENABLED=true
      - DRONE_GITEA_CLIENT_ID=3c704215-7bfe-4114-b0d6-e1a9c82e9118
      - DRONE_GITEA_CLIENT_SECRET=zffezm9pbpmvsWyas6J61WNJgVWH8Y5NC5Z7TNSKgt4=
      - DRONE_GITEA_SERVER=http://host.docker.internal:13000
      - DRONE_RPC_SECRET=d9856af41ffe31f5e8025be020e981be
      - DRONE_SERVER_HOST=host.docker.internal:18980
      - DRONE_SERVER_PROTO=http
      #- DRONE_USER_CREATE=username:root,machine:true,admin:true,token:5af24ab3d61ef6ac5e23n551178638dc
